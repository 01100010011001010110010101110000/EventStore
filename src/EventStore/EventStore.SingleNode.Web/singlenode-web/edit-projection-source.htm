<!doctype html>
<html>
<head>
    <title>Edit Projection Source</title>
    <script src="/web/es/lib/jquery/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/web/es/lib/jsrender/jsrender.js" type="text/javascript"></script>
    <script src="/web/es/lib/require-full.js" type="text/javascript"></script>
    <script src="/web/es/js/projections/lib/ace/ace.js" type="text/javascript"></script>
    <script src="/web/es/js/es.tmpl.js" type="text/javascript"></script>
    <script id="r-head">
        es.tmpl.renderHead();
    </script>
    <style>
        .container
        {
            width: inherit;
            margin-left: 50px;
            margin-right: 50px;
        }
    </style>
</head>
<body>
    <div id="content">
        <h1>Change Projection</h1>
        <h3><span id="projection-name"></span> - <span id="status"></span></h3>
        <div id="message" class="error" style="display: none;"></div>
        <div class="row">
            <div class="span12">
                <div id="commands-container">
                    <ul style="display: inline;">
                        <li><a href="#" id="btn-run" class="btn btn-success">Run</a></li>
                        <li><a href="#" id="btn-break" class="btn btn-danger">Stop</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div>
            <div class="control-group">
                <label class="control-label" for="source">
                    <strong>Source</strong></label>
                <div class="controls"><div class="uneditable-input" style="position: relative; display: block; width: 100%; height: 400px;">
                    <div id="ace-source" style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;" spellcheck="false" wrap="off"></div>
                </div></div>
            </div>
            <div class="control-group">
                <label class="control-label" for="emit"><strong>Emit Enabled</strong></label>
                <div class="controls">
                    <input type="checkbox" id="emit" /></div>
            </div>
            <div class="control-group">
                <label class="control-label" for="source">
                    <strong>State</strong></label>
                <div class="controls">
                    <textarea id="state" spellcheck="false" wrap="off" cols="100" rows="20" readonly="readonly"></textarea>
                </div>
            </div>
        </div>

        <script id="r-body">
            es.tmpl.renderBody();
        </script>
    </div>

    <script type="text/javascript">
        require.config({
            baseUrl: "/web/es/js",
            paths: {
            },
        });

        require(['projections/Observer', 'projections/Controller', 'projections/ui/Editor'],
            function (observer, controller, editor) {
                $(function () {
                    var aceEditor = ace.edit("ace-source");
                    aceEditor.setTheme("ace/theme/chrome");
                    aceEditor.getSession().setMode("ace/mode/javascript");

                    aceEditor.attr = $("#ace-source").attr.bind($("#ace-source"));
                    aceEditor.removeAttr = $("#ace-source").removeAttr.bind($("#ace-source"));

                    var projectionStatusUrl = location.hash.substr(1);
                    var projectionObserver = observer.create(projectionStatusUrl);
                    var projectionController = controller.create(projectionStatusUrl, projectionObserver);

                    var projectionEditor = editor.create(projectionStatusUrl, projectionObserver, projectionController, {
                        status: $("#status"),
                        name: $("#projection-name"),
                        source: aceEditor,
                        state: $("#state"),
                        message: $("#message"),
                        emit: $("#emit"),
                        start: $("#btn-run"),
                        stop: $("#btn-break"),
                    });

                    projectionEditor.bind();
                });
        });

    </script>
</body>
</html>
